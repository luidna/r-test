<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>REAPER Remote Control</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      text-align: center;
      margin-top: 80px;
      background: #111;
      color: white;
    }
    h2 {
      margin-bottom: 40px;
    }
    button {
      font-size: 1.5em;
      padding: 18px 50px;
      margin: 15px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.1s ease, background-color 0.3s;
    }
    button:active {
      transform: scale(0.95);
    }
    .record { background-color: #c00; color: white; }
    .stop { background-color: gray; color: white; }
    .refresh { background-color: #06c; color: white; font-size: 1em; padding: 10px 30px; }
    #status {
      margin-top: 30px;
      font-size: 1.3em;
    }
    #status span {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>üéöÔ∏è REAPER Remote Control</h2>

  <div>
    <button class="record" onclick="setCommand('RECORD')">RECORD</button>
    <button class="stop" onclick="setCommand('STOP')">STOP</button>
  </div>

  <div>
    <button class="refresh" onclick="fetchCurrentCommand()">üîÑ Refresh</button>
  </div>

  <p id="status">Current command: <span id="currentCmd">Loading...</span></p>

  <script>
    const API_BASE = "https://reaper-remote-api-luidnas-projects.vercel.app/api"; // üîß replace this
    const GITHUB_RAW_URL = "https://raw.githubusercontent.com/luidna/r-test/main/command.txt"; // üîß replace this

    async function setCommand(cmd) {
      document.getElementById("currentCmd").textContent = "Sending...";
      try {
        const resp = await fetch(`${API_BASE}/setCommand?cmd=${cmd}`);
        const json = await resp.json();
        if (json.success) {
          updateDisplay(cmd);
        } else {
          document.getElementById("currentCmd").textContent = `Error: ${json.error || "unknown"}`;
        }
      } catch (err) {
        console.error(err);
        document.getElementById("currentCmd").textContent = "‚ùå Network error";
      }
    }

    async function fetchCurrentCommand() {
      document.getElementById("currentCmd").textContent = "Loading...";
      try {
        const resp = await fetch(GITHUB_RAW_URL + `?t=${Date.now()}`); // cache-busting
        const text = (await resp.text()).trim().toUpperCase();
        if (text) updateDisplay(text);
        else document.getElementById("currentCmd").textContent = "Unknown";
      } catch (err) {
        console.error(err);
        document.getElementById("currentCmd").textContent = "Error fetching";
      }
    }

    function updateDisplay(cmd) {
      const current = document.getElementById("currentCmd");
      const body = document.body;
      current.textContent = cmd;

      if (cmd === "RECORD") {
        current.style.color = "red";
      } else if (cmd === "STOP") {
        current.style.color = "gray";
      } else if (cmd === "PLAY") {
        current.style.color = "#0f0";
      } else {
        current.style.color = "white";
      }
    }

    // Auto-load on startup
    fetchCurrentCommand();
  </script>
</body>
</html>
